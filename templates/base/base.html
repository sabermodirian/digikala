{% load static %}
<!DOCTYPE html>
<html lang="fa" dir="rtl"> {# کلاس dark-mode اینجا توسط JS اضافه می‌شود #}
<head>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="theme-color" content="#ef5661" />
  <title>
    {% block title %}
    سوپر مارکت آنلاین فوکالا
    {% endblock title %}
  </title>

  {% block meta %}
  <meta name="description" content="تجربه خرید آنلاین از سوپرمارکت در سریعترین زمان" />
  <meta name="author" content="Saber Modirian" />
  {% endblock meta %}

  <link href="{% static 'images/webramz.svg' %}" rel="shortcut icon" />
  
  <!-- ✅ استایل‌های اصلی و کتابخانه‌ها -->
  <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" />
  <link href="{% static 'css/owl.carousel.min.css' %}" rel="stylesheet" />
  <link href="{% static 'css/jquery.mCustomScrollbar.min.css' %}" rel="stylesheet" />
  <link href="{% static 'css/animate.min.css' %}" rel="stylesheet" />

  <!-- ✅ (جدید) اضافه کردن Bootstrap Icons -->
  <!-- برای نمایش آیکون‌های سوییچ تم (خورشید/ماه) و فلش‌های آکاردئون ضروری است -->
 <!-- ۱. اتصال آیکون‌های بوت‌استرپ (برای دکمه تم و آکاردئون ضروری است) -->
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  
  
  <!-- Font Awesome JS (حفظ شده از قبل) -->
  <script defer src="{% static 'js/solid.js' %}"></script>
  <script defer src="{% static 'js/fontawesome.js' %}"></script>
  

 <!-- ✅ این فایل اکنون شامل متغیرهای رنگی جدید و استایل‌های سایدبار است -->
  <link href="{% static 'css/style.css' %}" rel="stylesheet" />

</head>

<body>
  {% include "components/header.html" %}

  {% block main %}
  {% endblock main %}
  
  {% include "components/footer.html" %}

  <!-- ❌ تگ overlay قدیمی شما حذف شد چون در کد جدید ما تداخل ایجاد می‌کرد -->
  <!-- <div class="overlay"></div> -->

  <!-- START: Side Cart HTML (Added) -->
  <!-- این کد ساختار سبد خرید کشویی جدید است -->
  <div id="side-cart-overlay" class="side-cart-overlay"></div>
  <div id="side-cart" class="side-cart">
      <div class="side-cart-header">
          <h5>سبد خرید شما</h5>
          <button id="close-cart-btn" class="close-btn">&times;</button>
      </div>
      <div id="side-cart-body" class="side-cart-body">
          <div id="empty-cart-message" class="text-center p-5">
              <i class="fas fa-shopping-basket fa-3x text-muted"></i>
              <p class="mt-3">سبد خرید شما خالی است.</p>
          </div>
      </div>
      <div class="side-cart-footer">
          <div class="total-price-section">
              <span>جمع کل:</span>
              <span id="cart-total-price">0 تومان</span>
          </div>
          {% comment %} <a href="{% url 'orders:checkout' %}" class="btn btn-success btn-block">تکمیل خرید و پرداخت</a> {% endcomment %}
      </div>
  </div>
  <!-- END: Side Cart HTML (Added) -->


  <!-- اسکریپت‌های کتابخانه‌های پایه -->
  <script src="{% static 'js/jquery-3.4.1.min.js' %}"></script>
  <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
  <script src="{% static 'js/jquery.mCustomScrollbar.concat.min.js' %}"></script>
  <script src="{% static 'js/owl.carousel.min.js' %}"></script>
  {% comment %} <script src="{% static 'js/storage.js' %}"></script> {% endcomment %}
  
  <!-- ✅ SCRIPT: cart.js (Added) -->
  <!-- فایل جاوا اسکریپت جدید سبد خرید -->
  <script src="{% static 'js/cart.js' %}"></script>

  <!-- ✅ (جدید) اسکریپت‌های سایدبار درختی و تم -->
  <!-- این فایل‌ها منطق آکاردئون و تغییر رنگ قالب را کنترل می‌کنند -->
      <!-- ۳. اتصال فایل‌های جاوا اسکریپت در انتهای body -->
    <!-- defer باعث می‌شود این اسکریپت‌ها پس از بارگذاری کامل HTML اجرا شوند -->
    <script src="{% static 'js/theme_switcher.js' %}" defer></script>
    <script src="{% static 'js/category_accordion.js' %}" defer></script>


  <script>
    // --- این اسکریپت‌ها دست نخورده باقی می‌مانند ---
    //owl carousel script
    $(".main-slide").owlCarousel({ loop: true, animateOut: "fadeOut", animateIn: "fadeIn", margin: 0, nav: true, autoplay: true, dots: false, items: 1 });
    $(".products-carousel").owlCarousel({ rtl: true, loop: false, margin: 10, nav: true, dots: false, responsive: { 0: { items: 1, loop: true, stagePadding: 50, }, 480: { items: 2, stagePadding: 0, }, 768: { items: 3, stagePadding: 0, }, 992: { items: 4, stagePadding: 0, }, 1200: { items: 5, stagePadding: 0, }, }, });
    $(".main-page-lists").owlCarousel({ rtl: true, stagePadding: 50, loop: false, margin: 10, nav: false, responsive: { 0: { items: 1, }, 600: { items: 3, }, 1000: { items: 5, }, }, });
    
    //side menu script (اسکریپت منوی کناری شما)
    $(document).ready(function () {
      $(".sidebar").mCustomScrollbar({ theme: "minimal" });
      $(".dismiss, .overlay").on("click", function () {
        $(".sidebar").removeClass("active");
        $(".overlay").removeClass("active");
      });
      $("#sidemenuCollapse").on("click", function () {
        $("#sidemenu").addClass("active");
        $(".overlay").addClass("active");
        $(".collapse.in").toggleClass("in");
        $(this).attr("aria-expanded", "false");
      });
      // ❌ اسکریپت minicartCollapse شما حذف شد چون سبد خرید جدید جایگزین آن شده است
    });

    // ❌❌❌ تمام منطق قدیمی سبد خرید (product quantity, recalculateCart) از اینجا حذف شد
    // چون با سیستم جدید localStorage تداخل داشت و دیگر نیازی به آن نیست.
    
  </script>
  {% block jsscript %}
  {% endblock jsscript %}
</body>

</html>
