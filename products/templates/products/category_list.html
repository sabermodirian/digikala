{% extends "base/base.html" %}
{% load static %}

{% block title %}{% if category %}{{ category.name }}{% else %}Ù‡Ù…Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª{% endif %}{% endblock %}

{% block main %}
{# ğŸŒŸ Ú©Ø§Ù†ØªÛŒÙ†Ø± Ú©Ù„ÛŒ ØµÙØ­Ù‡Ù” Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª #}
<div class="container py-4">
  <div class="row g-4">
    <div class="col-lg-3">
      {# ğŸŒˆ Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± Ù…Ø®ØµÙˆØµ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ Ùˆ ÙÛŒÙ„ØªØ± Ø³Ø±ÛŒØ¹ #}
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <span class="fw-semibold">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</span>
            <i class="bi bi-funnel text-muted"></i>
          </div>
          <ul class="list-unstyled small mb-0">
            {% for c in categories %}
              <li class="mb-2">
                {# ğŸ§­ Ù„ÛŒÙ†Ú© Ù‡Ø± Ø¯Ø³ØªÙ‡ Ø¨Ø§ namespace ØµØ­ÛŒØ­ Ùˆ Ø­ÙØ¸ search/sort #}
            <a
                  href="{% url 'products:category_list_slug' c.slug %}{% if request.GET.search or request.GET.sort %}?{% if request.GET.search %}search={{ request.GET.search }}{% endif %}{% if request.GET.search and request.GET.sort %}&{% endif %}{% if request.GET.sort %}sort={{ request.GET.sort }}{% endif %}{% endif %}"
                  class="d-block text-decoration-none {% if category and c.slug == category.slug %}fw-bold text-dark{% else %}text-secondary{% endif %}">
                  <i class="bi bi-chevron-left small me-1"></i>{{ c.name }}
            </a>
              </li>
            {% empty %}

              <li class="text-muted">Ù‡ÛŒÚ† Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</li> {# ğŸª´ Ù¾ÛŒØ§Ù… Ø®Ø§Ù„ÛŒ Ø¨ÙˆØ¯Ù† Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ #}
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <div class="col-lg-9">
      {# ğŸ’¼ Ø¨Ø®Ø´ Ø§ØµÙ„ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ØµÙˆÙ„Ø§Øª + ÙØ±Ù… Ø³Ø±Ú† Ùˆ Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ #}
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <header class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-2 mb-3">
            <div>
              <h1 class="h5 mb-1">{% if category %}{{ category.name }}{% else %}Ù‡Ù…Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª{% endif %}</h1>
              <p class="text-muted small mb-0">
                {% if category %}
                  {{ category.description|default:"Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡." }}
                {% else %}
                  ØªÙ…Ø§Ù… Ù…Ø­ØµÙˆÙ„Ø§Øª ÙØ¹Ø§Ù„ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø¯Ø± Ø§ÛŒÙ† ØµÙØ­Ù‡ Ù‚Ø§Ø¨Ù„ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø§Ø³Øª.
                {% endif %}
              </p>
            </div>
            <span class="badge bg-light text-dark">{{ product_list|length }} Ù…Ø­ØµÙˆÙ„</span>
          </header>

          {# ğŸ” ÙØ±Ù… Ø¬Ø³Øªâ€ŒÙˆØ¬Ùˆ + Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø´ØªÙ† sort Ø¨Ù‡â€ŒØµÙˆØ±Øª hidden #}
          <form method="get" action="" class="category-search-form d-flex gap-2 align-items-center">
    <label class="form-label mb-0 text-nowrap" for="category-search-input">
        Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù…Ø­ØµÙˆÙ„Ø§Øª
    </label>
    <input
        id="category-search-input"
        class="form-control flex-grow-1"
        type="text"
        name="search"
        value="{{ request.GET.search }}"
        placeholder="Ù†Ø§Ù… Ú©Ø§Ù„Ø§ ÛŒØ§ Ø¨Ø±Ù†Ø¯"
              >
              {% if current_sort %}
                <input type="hidden" name="sort" value="{{ current_sort }}">
              {% endif %}
               <button class="btn search-submit-btn" type="submit" aria-label="Ø¬Ø³ØªØ¬Ùˆ">
                                    Ø¬Ø³ØªØ¬Ùˆ
              </button>
            </div>
          </form>

          {# ğŸ›ï¸ Ú©Ù†ØªØ±Ù„ Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ù†ØªØ§ÛŒØ¬ Ø¨Ø§ Ø­ÙØ¸ Ø§Ù†ØªØ®Ø§Ø¨ ÙØ¹Ù„ÛŒ #}
          <div class="d-flex align-items-center justify-content-end gap-2 mb-4 flex-wrap">
            <small class="text-muted">Ù†ÙˆØ¹ Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ:</small>
            <select id="sort-select" class="form-select form-select-sm" name="sort">
              <option value="newest" {% if current_sort == "newest" %}selected{% endif %}>Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ†</option>
              <option value="cheapest" {% if current_sort == "cheapest" %}selected{% endif %}>Ø§Ø±Ø²Ø§Ù†â€ŒØªØ±ÛŒÙ†</option>
              <option value="expensive" {% if current_sort == "expensive" %}selected{% endif %}>Ú¯Ø±Ø§Ù†â€ŒØªØ±ÛŒÙ†</option>
            </select>
          </div>

          {# ğŸ›’ Ú¯Ø±ÛŒØ¯ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø­ØµÙˆÙ„Ø› Ù‡Ø± Ú©Ø§Ø±Øª Ø¨Ø§ partial product-card Ø±Ù†Ø¯Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ #}
          <div class="row g-3">
            {% for prdct in product_list %}
              <div class="col-sm-6 col-lg-4">
                {% include "components/product-card.html" with product=prdct %}
              </div>
            {% empty %}
              <div class="col-12">
                <p class="text-muted text-center">Ù‡ÛŒÚ† Ù…Ø­ØµÙˆÙ„ÛŒ Ø¯Ø± Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{# âš™ï¸ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ú©ÙˆÚ†Ú© Ø¨Ø±Ø§ÛŒ Ø§Ø¹Ù…Ø§Ù„ Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø¯ÙˆÙ† Ø§Ø² Ø¯Ø³Øª Ø¯Ø§Ø¯Ù† search #}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const select = document.getElementById("sort-select");
    if (!select) return;
    select.addEventListener("change", function () {
      const params = new URLSearchParams(window.location.search);
      params.set("sort", this.value);
      const query = params.toString();
      window.location = query ? `${window.location.pathname}?${query}` : window.location.pathname;
    });
  });
</script>
{% endblock main %}
