{% extends "base/base.html" %}
{% load static %}

{% block title %}
  {% if category %}{{ category.name }}{% else %}Ù‡Ù…Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª{% endif %}
{% endblock %}

{% block main %}
{# ğŸŒŸ Ú©Ø§Ù†ØªÛŒÙ†Ø± Ú©Ù„ÛŒ ØµÙØ­Ù‡Ù” Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª #}
<div class="container py-4">
  <div class="row g-4">
    
    <!-- ğŸ”¹ Ø³ØªÙˆÙ† Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± (Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§) -->
    <div class="col-lg-3">
      {# âœ¨ Ø§ÛŒÙ†Ø¬Ø§ ÙØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯ Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± Ø¯Ø±Ø®ØªÛŒ Ø±Ø§ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… #}
      {% include "products/includes/category_sidebar_tree.html" %}
    </div>

    <!-- ğŸ”¹ Ø³ØªÙˆÙ† Ø§ØµÙ„ÛŒ (Ù…Ø­ØµÙˆÙ„Ø§Øª Ùˆ Ø¬Ø³ØªØ¬Ùˆ) -->
    <div class="col-lg-9">
      {# ... Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ø¨Ø§Ù‚ÛŒ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯ ... #}
      <div class="card shadow-sm border-0">
        <div class="card-body">
          
          {# ğŸ·ï¸ Ù‡Ø¯Ø± ØµÙØ­Ù‡ #}
          <header class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-2 mb-4">
            <div>
              <h1 class="h5 mb-1 fw-bold text-primary">
                  {% if category %}{{ category.name }}{% else %}Ù‡Ù…Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª{% endif %}
              </h1>
              <p class="text-muted small mb-0">
                {% if category %}
                  {{ category.description|default:"Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ØµÙˆÙ„Ø§Øª Ù…Ø±ØªØ¨Ø· Ø¨Ø§ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ." }}
                {% else %}
                  Ù„ÛŒØ³Øª Ú©Ø§Ù…Ù„ Ù…Ø­ØµÙˆÙ„Ø§Øª Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø± ÙØ±ÙˆØ´Ú¯Ø§Ù‡.
                {% endif %}
              </p>
            </div>
            <span class="badge bg-light text-dark border">{{ product_list|length }} Ú©Ø§Ù„Ø§</span>
          </header>

          {# ğŸ” ÙØ±Ù… Ø¬Ø³Øªâ€ŒÙˆØ¬Ùˆ Ùˆ Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø´Ù…Ø§ #}
          <form method="get" 
              action="" 
              class="category-search-form">
              <label for="category-search-input" class="search-label">
                  Ø¬Ø³ØªØ¬ÙˆÛŒ Ø¯Ø± Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ú©Ù†ÙˆÙ†ÛŒ:
              </label>
              <input type="text"
                     id="category-search-input"
                     name="search"
                     class="search-input"
                     placeholder="Ù†Ø§Ù… Ú©Ø§Ù„Ø§ØŒ Ø¨Ø±Ù†Ø¯ ÛŒØ§ ÙˆÛŒÚ˜Ú¯ÛŒ..."
                     value="{{ search_query }}">
              <button type="submit" class="search-btn">
                  <i class="bi bi-search me-1"></i>ÛŒØ§ÙØªÙ†
              </button>
              <select name="sort" class="sort-select form-select w-auto" onchange="this.form.submit()">
                  <option value="newest" {% if current_sort == 'newest' %}selected{% endif %}>Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ†</option>
                  <option value="min_price" {% if current_sort == 'min_price' %}selected{% endif %}>Ø§Ø±Ø²Ø§Ù†â€ŒØªØ±ÛŒÙ†</option>
                  <option value="max_price" {% if current_sort == 'max_price' %}selected{% endif %}>Ú¯Ø±Ø§Ù†â€ŒØªØ±ÛŒÙ†</option>
              </select>
          </form>

          {# ğŸ“¦ Ú¯Ø±ÛŒØ¯ Ù…Ø­ØµÙˆÙ„Ø§Øª #}
          <div id="product-grid" class="row g-3">
            {% for prdct in product_list %}
              <div class="col-6 col-lg-4 col-xl-3">
                {% include "components/product-card.html" with product=prdct %}
              </div>
            {% empty %}
              <div class="col-12 text-center py-5">
                <div class="text-muted">
                    <i class="bi bi-box-seam display-4 d-block mb-3"></i>
                    <p>Ù…Ø­ØµÙˆÙ„ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù…Ø´Ø®ØµØ§Øª ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>
                </div>
              </div>
            {% endfor %}
          </div>

          {# ğŸ“„ ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ (Pagination) #}
          {% if is_paginated %}
          <nav class="mt-4 d-flex justify-content-center">
            <ul class="pagination pagination-sm">
                {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}&search={{ search_query }}&sort={{ current_sort }}">Ù‚Ø¨Ù„ÛŒ</a>
                </li>
                {% endif %}
                <li class="page-item active">
                    <span class="page-link">{{ page_obj.number }} Ø§Ø² {{ page_obj.paginator.num_pages }}</span>
                </li>
                {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.next_page_number }}&search={{ search_query }}&sort={{ current_sort }}">Ø¨Ø¹Ø¯ÛŒ</a>
                </li>
                {% endif %}
            </ul>
          </nav>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock main %}
